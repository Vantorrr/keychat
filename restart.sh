#!/bin/bash

echo "๐ ะะตัะตะทะฐะฟััะบ KeyChat ะฑะพัะฐ ั ะพะฑะฝะพะฒะปะตะฝะฝัะผ ะผะพะฝะธัะพัะธะฝะณะพะผ..."

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ััะฐััะน ะฟัะพัะตัั
echo "๐ ะััะฐะฝะพะฒะบะฐ ััะฐัะพะณะพ ะฟัะพัะตััะฐ..."
pkill -f "node src/index.js" && echo "โ ะกัะฐััะน ะฟัะพัะตัั ะพััะฐะฝะพะฒะปะตะฝ" || echo "โน๏ธ ะัะพัะตัั ะฝะต ะฑัะป ะทะฐะฟััะตะฝ"

# ะะดะตะผ 2 ัะตะบัะฝะดั
sleep 2

# ะัะพะฒะตััะตะผ ััะพ ะฟัะพัะตัั ะดะตะนััะฒะธัะตะปัะฝะพ ะพััะฐะฝะพะฒะปะตะฝ
if pgrep -f "node src/index.js" > /dev/null; then
    echo "โ๏ธ ะัะธะฝัะดะธัะตะปัะฝะพะต ะทะฐะฒะตััะตะฝะธะต..."
    pkill -9 -f "node src/index.js"
fi

# ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ
echo "๐ ะะฐะฟััะบ ะพะฑะฝะพะฒะปะตะฝะฝะพะณะพ ะฑะพัะฐ..."
npm start &

# ะะดะตะผ ะทะฐะฟััะบะฐ
sleep 3

# ะัะพะฒะตััะตะผ ััะฐััั
if pgrep -f "node src/index.js" > /dev/null; then
    echo "โ ะะพั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝ!"
    echo "๐ ะกัะฐััั:"
    ./scripts/monitor.sh
    echo ""
    echo "๐ ะะปั ะฟัะพัะผะพััะฐ ะปะพะณะพะฒ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ:"
    echo "tail -f logs/bot.log"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ะฑะพัะฐ"
fi